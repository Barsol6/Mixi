@inject SignUpPopup SignUpPop
@inject Account Account

@using Mixi.Shared.Models.Account
@using Mixi.Shared.Models.UI
@implements IDisposable


<div class="@(SignUpPop.IsVisible ? "loginPopup" : "hidden")">
    <div class="closeButton" @onclick="HidePopup">X</div>
    @if (ComponentType is not null)
    {
        <DynamicComponent Type="@ComponentType" Parameters="@Parameters" @ref="_component"/>
    }
</div>




@code {

    private DynamicComponent? _component;
    public Type? ComponentType { get; set; }
    public IDictionary<string, object>? Parameters { get; set; }

    protected override void OnInitialized()
    {
        SignUpPop.IsVisibleChange += () => InvokeAsync(StateHasChanged);
        SignUpPop.IsVisibleChange += () =>
        {
            Account.Password = string.Empty;
            Account.Username = string.Empty;
            Account.PasswordRepeat = string.Empty;
        };
        base.OnInitializedAsync();
    }


    public async void ShowComponent<T>(IDictionary<string, object>? parameters = null)
    {
        ComponentType = typeof(T);
        Parameters = parameters;
        SignUpPop.IsVisible = true;
        StateHasChanged();
    }


    public void Dispose()
    {
        SignUpPop.IsVisibleChange -= StateHasChanged;
    }

    private void HidePopup()
    {
        SignUpPop.IsVisible = false;
        StateHasChanged();
    }


}