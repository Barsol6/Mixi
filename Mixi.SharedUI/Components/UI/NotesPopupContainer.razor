@inject NotePopup Notes;

@using Mixi.Shared.Models.UI
@implements IDisposable

<div class="@(Notes.IsVisible ? "popup" : "hidden")">
    @if (ComponentType is not null)
    {
        <DynamicComponent Type="@ComponentType" Parameters="@Parameters" @ref="_component"/>
    }
</div>

@code {
    private DynamicComponent? _component;
    private Type? ComponentType { get; set; }
    private IDictionary<string, object>? Parameters { get; set; }

    protected override void OnInitialized()
    {
        Notes.IsVisibleChange += () => InvokeAsync(StateHasChanged);
        base.OnInitialized();
    }

    public async void ShowComponent<T>(IDictionary<string, object>? parameters = null)
    {
        ComponentType = typeof(T);
        Parameters = parameters;
        Notes.IsVisible = true;

        StateHasChanged();
    }

    public void Dispose()
    {
        Notes.IsVisibleChange -= StateHasChanged;
    }

}